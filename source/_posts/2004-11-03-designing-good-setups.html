---
layout: post
title: "Designing Good Setups"
date: 2004-11-03
comments: false
---

<div class='post'>
<P>I have been mulling over the essentials of designing good setups and I found that most of it boils down to the component rules and the way you identify the data that goes to the setup. Microsoft enforces a set of rules that you should follow while authoring components. So, if the components are well managed, your product is well managed to a certain extent. Once you have identified the "Resources" in the setup, you would have to segregate them into components. Resources are bits installed by the setup, which do not change during the lifetime of the application, unless changed by a better version of the product by means of an MSI operation (small update/ minor upgrade/ major upgrade). <A href="http://blogs.msdn.com/robmen/">Rob</A> has blogged about what <A href="http://blogs.msdn.com/robmen/archive/2003/09/29/56470.aspx">setup is</A> and explains Resources, Application Data and User Data in good detail. I have my own opinions on <A href="http://installneo.blogspot.com/2004/10/handling-application-data.html">handling application data</A>. User Data is never installed, managed or removed and hence does not bother us.</P><br /><P><A href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/organizing_applications_into_components.asp">Components</A> are logical group of resources like Files, Registry entries, COM information, ODBC Data, Shortcuts and so on. Component is considered the atomic unit of installation. This statement is quite misleading and I have queued up a blog for Windows Installer's wierd behaviors to deal with that &lt;grin/&gt;. </P><br /><UL><br /><LI>As a rule of the thumb, you should place PE files (EXE, DLL, OCX and so on) individually in a component. Ensure that the key file that you select for a component is versioned. If the developer has not versioned the file, let him know that versioning a PE is very important to have a <A href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/default_file_versioning.asp">reliable upgrade</A>. There are certain situations in which the setup developer has to assert his/her position to ensure the quality of the software shipped. After all if the installation fails, the customers would have no chance to further evaluate or use the product. If you have non-versioned resources that need to be upgraded, ensure that they are made companions to the key file of the component. This would ensure that the versioning logic for the component is consistent.</LI><br /><LI>Never remove a resource or add a resouce to the component. If you have a file in the component, the only thing you can do is to bump up the file version or change the contents of the file itself. You can never add a file or remove a file from a component. This would result in incorrect reference counting and might prematurely remove resouces from the system or leave resource behind during uninstallation.</LI><br /><LI>You cannot include resources going to multiple locations in the same component. Also you cannot change the destination of the component once declared. You would have to ensure that once the component design has been finialized, its destination's position in the directory product tree structure does not change. </LI><br /><LI>If you have same file, especially a key file included in two different components that go to the same destination directory (e.g., 32 bit and 64 bit files or different language versions) ensure that these components are mutually exclusive by setting appropriate conditions on the components.</LI><br /><LI>Component code and name of the component must be the same.</LI><br /><LI>Make sure that there is only one COM server per component. Also ensure that the component is not linked to multiple features and is linked only to a single feature.</LI><br /><LI>Ensure that shortcuts are included in the same component that&nbsp;has the file. Thus, the shortcuts are installed only when the file is installed. This might seem&nbsp;very elementary but people from other installation worlds like InstallScript, find this particularly hard to digest.&nbsp;</LI></UL><br /><P>Microsoft has also included a nice little article on things that could happen <A href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/what_happens_if_the_component_rules_are_broken.asp">when component rules are broken</A> in the Platform SDK.</P></div>
